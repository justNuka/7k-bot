#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Pre-push hook pour build automatique (bot)
echo "ğŸ”¨ [pre-push] Build du bot en cours..."

# Build TypeScript
npm run build

# VÃ©rifie que le build a rÃ©ussi
if [ $? -eq 0 ]; then
  echo "âœ… [pre-push] Build rÃ©ussi !"
  
  # Ajoute dist/ au commit s'il y a des changements
  if git diff --quiet dist/ 2>/dev/null; then
    echo "â„¹ï¸  [pre-push] Aucun changement dans dist/"
  else
    echo "ğŸ“¦ [pre-push] Ajout de dist/ au commit..."
    git add dist/
    git commit --amend --no-edit --no-verify
    echo "âœ… [pre-push] dist/ ajoutÃ© au dernier commit"
  fi
else
  echo "âŒ [pre-push] Build Ã©chouÃ© ! Push annulÃ©."
  exit 1
fi
